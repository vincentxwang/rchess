// Piece-square tables.

use crate::core::structs::{Color, Square};
use crate::game::piece::Piece;
use crate::engine::evaluate::Score;

lazy_static! {
    pub static ref BLACK_PST: [[i16; 64]; 6] = [
        BLACK_PAWN_PST,
        BLACK_KNIGHT_PST,
        BLACK_BISHOP_PST,
        BLACK_ROOK_PST,
        BLACK_QUEEN_PST,
        BLACK_KING_PST,
    ];

    pub static ref WHITE_PST: [Vec<i16>; 6] = [
        reverse(BLACK_PAWN_PST),
        reverse(BLACK_KNIGHT_PST),
        reverse(BLACK_BISHOP_PST),
        reverse(BLACK_ROOK_PST),
        reverse(BLACK_QUEEN_PST),
        reverse(BLACK_KING_PST),
    ];
}

const BLACK_PAWN_PST: [i16; 64] = [
    0,  0,  0,  0,  0,  0,  0,  0,
    50, 50, 50, 50, 50, 50, 50, 50,
    10, 10, 20, 30, 30, 20, 10, 10,
     5,  5, 10, 25, 25, 10,  5,  5,
     0,  0,  0, 20, 20,  0,  0,  0,
     5, -5,-10,  0,  0,-10, -5,  5,
     5, 10, 10,-20,-20, 10, 10,  5,
     0,  0,  0,  0,  0,  0,  0,  0
];

const BLACK_KNIGHT_PST: [i16; 64] = [
    -50,-40,-30,-30,-30,-30,-40,-50,
    -40,-20,  0,  0,  0,  0,-20,-40,
    -30,  0, 10, 15, 15, 10,  0,-30,
    -30,  5, 15, 20, 20, 15,  5,-30,
    -30,  0, 15, 20, 20, 15,  0,-30,
    -30,  5, 10, 15, 15, 10,  5,-30,
    -40,-20,  0,  5,  5,  0,-20,-40,
    -50,-40,-30,-30,-30,-30,-40,-50,
];

const BLACK_BISHOP_PST: [i16; 64] = [
    -20,-10,-10,-10,-10,-10,-10,-20,
    -10,  0,  0,  0,  0,  0,  0,-10,
    -10,  0,  5, 10, 10,  5,  0,-10,
    -10,  5,  5, 10, 10,  5,  5,-10,
    -10,  0, 10, 10, 10, 10,  0,-10,
    -10, 10, 10, 10, 10, 10, 10,-10,
    -10,  5,  0,  0,  0,  0,  5,-10,
    -20,-10,-10,-10,-10,-10,-10,-20,
];

const BLACK_ROOK_PST: [i16; 64] = [
    -50,-40,-30,-30,-30,-30,-40,-50,
    -40,-20,  0,  0,  0,  0,-20,-40,
    -30,  0, 10, 15, 15, 10,  0,-30,
    -30,  5, 15, 20, 20, 15,  5,-30,
    -30,  0, 15, 20, 20, 15,  0,-30,
    -30,  5, 10, 15, 15, 10,  5,-30,
    -40,-20,  0,  5,  5,  0,-20,-40,
    -50,-40,-30,-30,-30,-30,-40,-50,
];

const BLACK_QUEEN_PST: [i16; 64] = [
    -20,-10,-10, -5, -5,-10,-10,-20,
    -10,  0,  0,  0,  0,  0,  0,-10,
    -10,  0,  5,  5,  5,  5,  0,-10,
     -5,  0,  5,  5,  5,  5,  0, -5,
      0,  0,  5,  5,  5,  5,  0, -5,
    -10,  5,  5,  5,  5,  5,  0,-10,
    -10,  0,  5,  0,  0,  0,  0,-10,
    -20,-10,-10, -5, -5,-10,-10,-20
];

const BLACK_KING_PST: [i16; 64] = [
    -30,-40,-40,-50,-50,-40,-40,-30,
    -30,-40,-40,-50,-50,-40,-40,-30,
    -30,-40,-40,-50,-50,-40,-40,-30,
    -30,-40,-40,-50,-50,-40,-40,-30,
    -20,-30,-30,-40,-40,-30,-30,-20,
    -10,-20,-20,-20,-20,-20,-20,-10,
     20, 20,  0,  0,  0,  0, 20, 20,
     20, 30, 10,  0,  0, 10, 30, 20
];

// If we're using this just to transform a reflection over a horizontal on the board AND pst is symmetrical over the vertical, this is alright. 
// But also note that this maps a1 => h8 and not a1 => h8.
pub fn reverse(pst: [i16; 64]) -> Vec<i16> {
    let reversed_pst = pst.iter().copied().rev().collect();
    reversed_pst
}

pub fn get_pst_eval(color: Color, sq: &Square, piece: Piece) -> Score{
    let score_val = match color {
        Color::White => WHITE_PST[piece as usize][*sq as usize],
        Color::Black => BLACK_PST[piece as usize][*sq as usize],
    };
    Score(score_val)
}